async function getUniqueValidationData(t,e,r,o){let s="action=validation_ajax_action&nonce="+encodeURIComponent(o)+"&id="+encodeURIComponent(e);Object.keys(t).forEach(e=>{s+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t[e])});try{var i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s});if(i.ok)return(await i.json()).data}catch(e){console.error(e)}}async function fieldValidation(e,t,r,o,s=!1){let n=!1,i=null,l=null,a={};const c=(e,t,r={})=>{i||(i=e,l=t,a=r)};let m=null;var f=document.querySelectorAll('input[data-unique="true"]');if(0!==f.length){var u={};for(const L of f){var d=L.name,g=L.value;u[d]=g}m=await getUniqueValidationData(u,e,t,r)}for(const _ of s?[o]:Array.from(o.querySelectorAll(".srfm-block-single"))){let t=!1;if(Array.isArray(window.sureforms?.skipValidationCallbacks)&&window.sureforms.skipValidationCallbacks.forEach(e=>{"function"==typeof e&&(t=t||e(_))}),!t){var w=_.closest("form").getAttribute("form-id");if(w===e){let r,e;e=!0===_.classList.contains("srfm-phone-block")?(r=_.querySelector(".srfm-input-phone"))?.nextElementSibling?.value:(r=_.querySelector("input, textarea, select")).value;var b,p,w=r.getAttribute("data-required"),S=r.getAttribute("data-unique");let t=r.getAttribute("name");const x=_.querySelector(".srfm-error-message");if(t=t&&t.replace(/_/g," "),w&&"hidden"!==r.type&&("true"!==w||e?r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!1):(r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!0),x&&(x.textContent=x.getAttribute("data-error-msg")),n=!0,c(r,r.closest(".srfm-block"))),r.addEventListener("input",()=>{window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!1)})),"true"===S&&""!==e&&(m?.some(e=>"not unique"===e[t])?(r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!0),x.style.display="block",x.textContent=x.getAttribute("data-unique-msg"),n=!0,c(r,r.closest(".srfm-block"))):r&&(window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!1),x.style.display="none")),_.classList.contains("srfm-multi-choice-block")||_.classList.contains("srfm-checkbox-block")||_.classList.contains("srfm-gdpr-block")){var y=_.querySelectorAll("input"),S=y[0].getAttribute("data-required");let t=!1,r=null;for(let e=0;e<y.length;e++)if(r||"hidden"===y[e].type||(r=y[e]),y[e].checked){t=!0;break}"true"!==S||t?x&&window?.srfm?.toggleErrorState(_,!1):(x&&(x.textContent=_.querySelector(".srfm-error-message").getAttribute("data-error-msg"),window?.srfm?.toggleErrorState(_,!0)),n=!0,c(r,_)),y.forEach(e=>{e.addEventListener("input",()=>{window?.srfm?.toggleErrorState(_,!1)})})}if(_.classList.contains("srfm-url-block")&&(S=_.querySelector("input"),_.classList.contains("srfm-url-error")&&(window?.srfm?.toggleErrorState(_,!0),n=!0,c(S,_)),S.addEventListener("input",()=>{window?.srfm?.toggleErrorState(_,!1)})),_.classList.contains("srfm-phone-block")&&(S=_.querySelectorAll("input")[1],_.classList.contains("srfm-phone-error")&&(window?.srfm?.toggleErrorState(_,!0),n=!0,c(S,_)),_.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>{window?.srfm?.toggleErrorState(_,!1)})})),_.classList.contains("srfm-password-block-wrap")&&(S=_)&&(S=S.querySelector(".srfm-password-confirm-block"))&&(p=S.querySelector(".srfm-input-password-confirm").value,b=S.querySelector(".srfm-error-message"),!p&&b&&"true"===w?(b.textContent=b.getAttribute("data-error-msg"),window?.srfm?.toggleErrorState(S,!0),c(p,S),n=!0):p!==e?(window?.srfm?.toggleErrorState(S,!0),b.textContent=window?.srfm_submit?.messages?.srfm_confirm_password_same,c(p,S),n=!0):window?.srfm?.toggleErrorState(S,!1)),_.classList.contains("srfm-email-block-wrap")){const C=_;if(C){const V=C.querySelector(".srfm-email-confirm-block");C.classList.contains("srfm-valid-email-error")&&(c(r,C),n=!0),V&&(b=V.querySelector(".srfm-input-email-confirm"),p=V.querySelector(".srfm-input-email-confirm").value,S=V.querySelector(".srfm-error-message"),!p&&S&&"true"===w?(S.textContent=S.getAttribute("data-error-msg"),window?.srfm?.toggleErrorState(V,!0),c(b,V),n=!0):p!==e?(window?.srfm?.toggleErrorState(V,!0),S.textContent=window?.srfm_submit?.messages?.srfm_confirm_email_same,c(b,V),n=!0):window?.srfm?.toggleErrorState(V,!1),b.addEventListener("input",()=>{window?.srfm?.toggleErrorState(V,!1)})),C.querySelector(".srfm-input-email").addEventListener("input",()=>{window?.srfm?.toggleErrorState(C,!1)})}}if(_.classList.contains("srfm-upload-block")&&("true"!==(k=(S=_.querySelector(".srfm-input-upload")).getAttribute("data-required"))||S.value?r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!1):("true"===k&&x&&(x.textContent=x.getAttribute("data-error-msg")),r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!0),n=!0,c(S,_)),S.addEventListener("input",()=>{r&&window?.srfm?.toggleErrorState(r.closest(".srfm-block"),!1)})),_.classList.contains("srfm-number-block")){var k=r.getAttribute("min"),S=r.getAttribute("max"),E=r.getAttribute("format-type");if(e){var E="eu-style"===E?parseFloat(e.replace(/\./g,"").replace(",",".")):parseFloat(e.replace(/,/g,""));if(k||S){let e=!1,t="";k&&""!==k&&Number(E)<Number(k)?(e=!0,t=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_input_min_value,k)):S&&""!==S&&Number(E)>Number(S)&&(e=!0,t=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_input_max_value,S)),window?.srfm?.toggleErrorState(r.closest(".srfm-block"),e),x&&(x.textContent=e?t:"",e)&&(n=!0,c(r,_))}}}if(_.classList.contains("srfm-rating-block")&&("true"!==(E=_.querySelector(".srfm-input-rating")).getAttribute("data-required")||E.value?window?.srfm?.toggleErrorState(E.closest(".srfm-block"),!1):(window?.srfm?.toggleErrorState(E.closest(".srfm-block"),!0),n=!0,c(_.querySelector(".srfm-icon"),_))),_.classList.contains("srfm-slider-block")){var S=_.getAttribute("data-required"),v=_.querySelector(".srfm-input-slider"),h=_.querySelector(".srfm-text-slider"),q=_.getAttribute("data-default");if("true"===S){let e=!1;(e=(!v||v.dataset.interacted||q&&"false"!==q)&&(!h||h.dataset.interacted||q&&"false"!==q)?e:!0)?(window?.srfm?.toggleErrorState(_,!0),n=!0,c(v,_)):window?.srfm?.toggleErrorState(_,!1)}}if(_.classList.contains("srfm-dropdown-block")){S=_.querySelectorAll(".srfm-input-dropdown-hidden");const I=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;S.forEach(e=>{const t=e.getAttribute("data-required");var r,o,s,i=e.getAttribute("name");"true"!==t||e.value?e.value?(s=e.getAttribute("data-min-selection"),r=e.getAttribute("data-max-selection"),(s||r)&&(o=e.value.split(","),s&&o.length<s?(x.textContent=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_dropdown_min_selections,s),window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!0),n=!0):r&&o.length>r&&(x.textContent=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_dropdown_max_selections,r),window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!0),n=!0))):window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!1):(x.textContent=x.getAttribute("data-error-msg"),window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!0),n=!0),n&&(s=window?.srfm?.[i]||e,c(s,e.closest(".srfm-block"),{shouldDelayOnFocus:!0})),new I(()=>{e.value?window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!1):"true"===t&&window?.srfm?.toggleErrorState(e.closest(".srfm-block"),!0)}).observe(e,{attributes:!0,attributeFilter:["value"]})})}if(_.classList.contains("srfm-multi-choice-block")){var A=_.querySelectorAll("input"),h=A[0].getAttribute("data-min-selection"),q=A[0].getAttribute("data-max-selection");let t=null,r=0,e=!1;for(let e=0;e<A.length;e++)t||"hidden"===A[e].type||(t=A[e]),A[e].checked&&r++;(h||q)&&0<r&&(!e&&0<h&&(w&&1<h||!w)&&r<h&&(x.textContent=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_multi_choice_min_selections,h),e=!0),!e&&0<q&&r>q&&(x.textContent=window?.srfm?.srfmSprintfString(window?.srfm_submit?.messages?.srfm_multi_choice_max_selections,q),e=!0),e?(window?.srfm?.toggleErrorState(_,!0),c(t,_),n=!0):w||window?.srfm?.toggleErrorState(_,!1))}}}}return!!n&&{validateResult:n,firstErrorInput:i,scrollElement:l,...a}}function initializeInlineFieldValidation(){["srfm-input-block","srfm-email-block-wrap","srfm-url-block","srfm-phone-block","srfm-checkbox-block","srfm-gdpr-block","srfm-number-block","srfm-multi-choice-block","srfm-datepicker-block","srfm-upload-block","srfm-rating-block","srfm-textarea-block","srfm-dropdown-block","srfm-slider-block"].forEach(e=>addBlurListener(e,"."+e))}function addBlurListener(t,r){var e=Array.from(document.getElementsByClassName(t));if(e)for(const o of e){let e=o.querySelector("input")||o.querySelector("textarea")||o.querySelector("select");if("srfm-upload-block"===t&&(e=o.querySelector('input[type="file"]')),"srfm-rating-block"===t&&addRatingBlurListener(e,o,r),"srfm-multi-choice-block"===t&&addMultiChoiceBlurListener(e,o,r),"srfm-email-block-wrap"===t&&addEmailBlurListener(o,r),"srfm-slider-block"===t&&addSliderBlurListener(e,o,r),"srfm-dropdown-block"===t){const s=e.getAttribute("name");setTimeout(()=>{window?.srfm?.[s]?.on("blur",function(){fieldValidationInit(e,r)})},500)}(e="srfm-phone-block"===t?o.querySelector(".srfm-input-phone"):e)&&e.addEventListener("blur",async function(){fieldValidationInit(e,r)})}}function addRatingBlurListener(e,t,r){t.querySelectorAll(".srfm-icon").forEach(e=>{e.addEventListener("blur",async function(){fieldValidationInit(e,r)})})}function addMultiChoiceBlurListener(e,t,r){t.querySelectorAll(".srfm-input-multi-choice-single").forEach(e=>{e.addEventListener("blur",async function(){fieldValidationInit(e,r)})})}function addEmailBlurListener(e,t){var r=e.querySelectorAll("input");const n=e.closest(t);r.forEach(i=>{i.addEventListener("input",async function(){i.value=i.value.trim().toLowerCase();let e=!1;/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i.value)&&(e=!0);var t=i.classList.contains("srfm-input-email-confirm")?n.querySelector(".srfm-email-confirm-block"):n.querySelector(".srfm-email-block"),r=t.querySelector(".srfm-error-message");if(i.value||(r.style.display="none",t.classList.remove("srfm-valid-email-error")),i.classList.contains("srfm-input-email-confirm")){var o=n.querySelector(".srfm-input-email"),s=n.querySelector(".srfm-email-confirm-block").querySelector(".srfm-error-message");if(o.value!==i.value)return s.style.display="block",s.textContent=window?.srfm_submit?.messages?.srfm_confirm_email_same,void window?.srfm?.toggleErrorState(n,!0);window?.srfm?.toggleErrorState(n,!1),s.textContent="",s.style.display="none"}e?(r.style.display="none",t.parentElement.classList.remove("srfm-valid-email-error"),r.removeAttribute("id")):(t.parentElement.classList.add("srfm-valid-email-error"),r.style.display="block",r.innerHTML=window?.srfm_submit?.messages?.srfm_valid_email,r.id=r.getAttribute("data-srfm-id"))})})}function addSliderBlurListener(e,t,r){const o=t.querySelector(".srfm-input-slider");t=t.querySelector(".srfm-text-slider");if(o&&o.addEventListener("blur",async function(){fieldValidationInit(o,r)}),t){const s=t.querySelector(".srfm-slider-thumb");s&&s.addEventListener("blur",async function(){fieldValidationInit(s,r)})}}const fieldValidationInit=async(e,t)=>{e=e.closest(t),t=e.closest("form");await fieldValidation(t.getAttribute("form-id"),t.getAttribute("ajaxurl"),t.getAttribute("nonce"),e,!0)},handleScrollAndFocusOnError=e=>{var t,r,o;e?.firstErrorInput&&(e?.scrollElement&&(t=e.scrollElement.getBoundingClientRect().top,r=window.pageYOffset,o=window.innerHeight,window.scroll({top:t+r-o/2,behavior:"smooth"})),e?.shouldDelayOnFocus?setTimeout(()=>{e.firstErrorInput.focus({preventScroll:!0})},500):e.firstErrorInput.focus({preventScroll:!0}))},handleCaptchaValidation=(e,t,r,o)=>{if(!(e||t||r||o))return!0;let s;"v2-checkbox"===e?s=grecaptcha.getResponse():t?s=hcaptcha.getResponse():r&&(s=turnstile.getResponse());e=0<s.length;return o.style.display=e?"none":"block",e};export{fieldValidation,initializeInlineFieldValidation,handleScrollAndFocusOnError,handleCaptchaValidation};